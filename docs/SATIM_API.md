# SATIM API Documentation

Complete documentation for SATIM/GIE Monétique REST API integration.

## Base URLs

**Sandbox (Test Environment):**
```
https://test2.satim.dz/payment/rest
```

**Production:**
```
https://satim.dz/payment/rest
```

## API Endpoints

### 1. Payment Registration (register.do)

Register a new payment order with SATIM.

**Endpoint:** `GET /register.do`

**Parameters:**

| Parameter | Type | Mandatory | Description |
|-----------|------|-----------|-------------|
| userName | AN..30 | Yes | Merchant's login received during registration |
| password | AN..30 | Yes | Merchant's password received during registration |
| orderNumber | AN..10 | Yes | Unique order identifier in merchant's system |
| amount | N..20 | Yes | Order amount in centimes, must be multiple of 100, minimum 5000 (50 DA) |
| currency | N3 | Yes | ISO 4217 currency code (012 for DZD) |
| returnUrl | AN..512 | Yes | URL to redirect customer after successful payment |
| failUrl | AN..512 | No | URL to redirect customer if payment failed |
| description | AN..512 | No | Free-form description of the order |
| language | A2 | Yes | ISO 639-1 language code (AR, FR, EN) |
| jsonParams | AN..1024 | Yes | JSON string with additional parameters |

**jsonParams Structure:**

```json
{
  "force_terminal_id": "YOUR_TERMINAL_ID",
  "udf1": "InvoiceNum123",
  "udf2": "optional",
  "udf3": "optional",
  "udf4": "optional",
  "udf5": "optional",
  "fundingTypeIndicator": "CP"
}
```

| Field | Format | Mandatory | Description |
|-------|--------|-----------|-------------|
| force_terminal_id | AN..16 | Yes | Terminal ID assigned by bank |
| udf1 | AN..20 | Yes | User-defined field (invoice, order number, etc.) |
| udf2-udf5 | AN..20 | No | Additional user-defined fields |
| fundingTypeIndicator | String | No | Transaction type: "CP" or "698" for bill payment |

**Example Request:**

```
https://test2.satim.dz/payment/rest/register.do?
  userName=YOUR_USERNAME&
  password=YOUR_PASSWORD&
  orderNumber=ORDER123&
  amount=50000&
  currency=012&
  language=fr&
  returnUrl=https://mysite.com/success&
  failUrl=https://mysite.com/failed&
  jsonParams={"force_terminal_id":"YOUR_TERMINAL_ID","udf1":"INV001"}
```

**Response:**

```json
{
  "errorCode": "0",
  "orderId": "V721uPPfNNofVQAAABL3",
  "formUrl": "https://test2.satim.dz/payment/epg/merchants/merchantsatim/payment.html?mdOrder=V721uPPfNNofVQAAABL3&language=fr"
}
```

| Field | Type | Description |
|-------|------|-------------|
| errorCode | String | "0" for success, other codes for errors |
| orderId | String | Unique order ID (mdOrder) generated by EPG |
| formUrl | String | Payment page URL for customer redirect |
| errorMessage | String | Error description (if error occurred) |

---

## 2. Payment Acknowledgment (acknowledgeTransaction.do)

Confirms that the merchant has successfully handled the client redirect after a payment attempt. This endpoint **MUST** be called after the customer returns from the payment page. If no confirmation is received, the transaction will be automatically cancelled after a certain delay.

**Endpoint:** `GET /public/acknowledgeTransaction.do`

**Parameters:**

| Parameter | Type | Mandatory | Description |
|-----------|------|-----------|-------------|
| userName | AN..30 | Yes | Merchant's login |
| password | AN..30 | Yes | Merchant's password |
| mdOrder | ANS20 | Yes | Order ID (orderId) generated by EPG from register.do |
| language | A2 | Yes | Language code (AR, FR, EN) |

**Example Request:**

```
https://test2.satim.dz/payment/rest/public/acknowledgeTransaction.do?
  userName=YOUR_USERNAME&
  password=YOUR_PASSWORD&
  mdOrder=6bbnSxXAZJ4eDAAAABHE&
  language=EN
```

**Response:**

```json
{
  "ErrorCode": "0",
  "ErrorMessage": "Success",
  "OrderStatus": 2,
  "OrderNumber": "CMD0000004",
  "Amount": 100320,
  "currency": "012",
  "depositAmount": 100320,
  "expiration": "202701",
  "cardholderName": "CARD HOLDER",
  "Pan": "6280****7215",
  "authorizationResponseId": "913180",
  "approvalCode": "913180",
  "actionCode": 0,
  "actionCodeDescription": "Votre paiement a été accepté",
  "Ip": "10.12.12.14",
  "params": {
    "respCode_desc": "Votre paiement a été accepté",
    "udf1": "Bill00001",
    "respCode": "00"
  },
  "SvfeResponse": "00"
}
```

**Response Fields:**

| Field | Type | Mandatory | Description |
|-------|------|-----------|-------------|
| ErrorCode | N3 | Yes | "0" for success |
| ErrorMessage | AN..512 | No | Error description |
| OrderStatus | N2 | No | Order status code (see OrderStatus table below) |
| OrderNumber | AN..20 | Yes | Original merchant order number |
| Amount | N..20 | Yes | Order amount in centimes |
| currency | N3 | No | ISO 4217 currency code |
| depositAmount | N5 | Yes | Amount debited in order currency |
| expiration | N6 | No | Card expiry date (YYYYMM) |
| cardholderName | AN..20 | No | Cardholder name (2-26 chars) |
| Pan | N..19 | No | Masked card number |
| authorizationResponseId | AN..6 | No | Authorization code (6 chars) |
| approvalCode | AN6 | No | IPS authorization code |
| actionCode | N3 | Yes | Processing system auth code |
| actionCodeDescription | AN..512 | Yes | Action code description |
| Ip | AN..20 | No | Customer IP address |
| clientId | AN..255 | No | Customer identifier |
| bindingId | AN..255 | No | Binding identifier (for saved cards) |
| paymentAccountReference | ANS..999 | No | Payment account data |
| Description | ANS..512 | No | Order description |
| params | Object | No | Additional parameters (udf1-udf5, respCode, etc.) |
| SvfeResponse | String | No | SVFE response code |

**Order Status Codes:**

| Code | Description |
|------|-------------|
| 0 | Order registered, but not paid |
| -1 | Transaction declined - none of the specified statuses is suitable |
| 1 | Transaction has been approved (one-phase) or preauth put on hold (two-phase) |
| 2 | Amount was deposited successfully |
| 3 | Authorization has been reversed |
| 4 | Transaction has been refunded |
| 6 | Authorization is declined |
| 7 | Card Added |
| 8 | Card Updated |
| 9 | Card verified |
| 10 | Recurring Template Added |
| 11 | Debited |

**Error Codes:**

| Code | Message |
|------|---------|
| 0 | Success |
| 2 | Order declined because of an error in payment credentials |
| 5 | Access denied / User must change password / orderId is empty |
| 6 | Unregistered order Id |
| 7 | System error |

---

## 3. Refund (refund.do)

Refund money deposited to the customer's card. The gateway allows multiple refunds, but their total cannot exceed the deposited amount. User must have the corresponding authorization in the system.

**Endpoint:** `GET /refund.do`

**Parameters:**

| Parameter | Type | Mandatory | Description |
|-----------|------|-----------|-------------|
| userName | AN..30 | Yes | Merchant's login |
| password | AN..30 | Yes | Merchant's password |
| orderId | ANS20 | Yes | Order ID (mdOrder) from registration |
| amount | N..20 | Yes | Refund amount in centimes (must be multiple of 100, min 5000) |

**Example Request:**

```
https://test2.satim.dz/payment/rest/refund.do?
  userName=YOUR_USERNAME&
  password=YOUR_PASSWORD&
  orderId=6bbnSxXAZJ4eDAAAABHE&
  amount=20000
```

**Response:**

```json
{
  "errorCode": "0"
}
```

**Response Fields:**

| Field | Type | Mandatory | Description |
|-------|------|-----------|-------------|
| errorCode | N3 | No | "0" for success, other codes for errors |
| errorMessage | AN..512 | No | Error description or success message |

**Error Codes:**

| Code | Message |
|------|---------|
| 0 | No system error |
| 5 | Access denied / Invalid amount / Deposit amount must be ≥1 currency unit / Refund already exists |
| 6 | Unregistered OrderId |
| 7 | System error / Payment must be in a correct state |

---

## Error Codes (register.do)

| Code | Message |
|------|---------|

| Parameter | Type | Mandatory | Description |
|-----------|------|-----------|-------------|
| userName | AN..30 | Yes | Merchant's login |
| password | AN..30 | Yes | Merchant's password |
| mdOrder | ANS20 | Yes | Order ID returned from register.do |
| language | A2 | Yes | Language code (AR, FR, EN) |

**Example Request:**

```
https://test2.satim.dz/payment/rest/public/acknowledgeTransaction.do?
  userName=YOUR_USERNAME&
  password=YOUR_PASSWORD&
  mdOrder=V721uPPfNNofVQAAABL3&
  language=fr
```

**Response:**

```json
{
  "errorCode": "0",
  "errorMessage": "Success",
  "orderNumber": "ORDER123",
  "orderStatus": "1",
  "amount": 50000,
  "currency": "012",
  "authorizationCode": "123456",
  "Pan": "628058******7215",
  "approvalCode": "OK"
}
```

| Field | Type | Description |
|-------|------|-------------|
| errorCode | String | "0" for success |
| orderNumber | String | Original merchant order number |
| orderStatus | String | Order status code (see status codes below) |
| amount | Number | Payment amount in centimes |
| currency | String | Currency code |
| authorizationCode | String | Authorization code from bank |
| Pan | String | Masked card number |

---

### 3. Refund (refund.do)

Refund a payment (full or partial).

**Endpoint:** `GET /refund.do`

**Parameters:**

| Parameter | Type | Mandatory | Description |
|-----------|------|-----------|-------------|
| userName | AN..30 | Yes | Merchant's login |
| password | AN..30 | Yes | Merchant's password |
| orderId | ANS20 | Yes | Order ID (mdOrder) to refund |
| language | A2 | Yes | Language code |
| amount | N..20 | No | Amount to refund (full refund if omitted) |
| currency | N3 | No | Currency code (012 for DZD) |

**Example Request:**

```
https://test2.satim.dz/payment/rest/refund.do?
  userName=YOUR_USERNAME&
  password=YOUR_PASSWORD&
  orderId=V721uPPfNNofVQAAABL3&
  language=fr&
  amount=25000&
  currency=012
```

**Response:**

```json
{
  "errorCode": "0",
  "errorMessage": "Success",
  "amount": 25000,
  "currency": "012"
}
```

---

## Error Codes

| Code | Message |
|------|---------|
| 0 | No system error (success) |
| 1 | Order already processed / duplicate order |
| 3 | Unknown currency |
| 4 | Required parameter not specified |
| 5 | Incorrect parameter value or access denied |
| 7 | System error |
| 14 | Paymentway is invalid |

## Order Status Codes

| Status | Description |
|--------|-------------|
| 0 | Order registered, not paid |
| 1 | Transaction approved (deposited) |
| 2 | Transaction approved (reversed) |
| 3 | Transaction declined |
| 4 | Transaction pending |
| 5 | Card blocked |
| 6 | Transaction cancelled |

## Important Rules

### Amount Format
- ✅ Must be in centimes (multiply DA by 100)
- ✅ Must be multiple of 100
- ✅ Minimum: 5000 (50 DA)
- ✅ Examples:
  - 50.00 DA → 5000
  - 100.50 DA → 10050
  - 806.50 DA → 80650

### Currency Code
- ✅ DZD = "012" (ISO 4217)

### Order Number
- ✅ Must be unique for each transaction
- ✅ Maximum 10 characters
- ✅ Alphanumeric

### Language Codes
- ✅ AR = Arabic
- ✅ FR = French
- ✅ EN = English

### URLs
- ✅ Must be HTTPS in production
- ✅ Must be publicly accessible
- ✅ Maximum 512 characters

## Integration Flow

```
1. Merchant creates order
   ↓
2. Call register.do
   ↓
3. Receive orderId and formUrl
   ↓
4. Redirect customer to formUrl
   ↓
5. Customer completes payment on SATIM page
   ↓
6. SATIM redirects to returnUrl (success) or failUrl (failure)
   ↓
7. Call acknowledgeTransaction.do to verify
   ↓
8. Update order status in your system
```

## Security Notes

⚠️ **Never expose credentials in client-side code**
⚠️ **Always verify payment status on server-side**
⚠️ **Use HTTPS in production**
⚠️ **Validate all responses**
⚠️ **Log all transactions**

## Testing

Use sandbox credentials:
```
Username: your_sandbox_username
Password: your_sandbox_password
Terminal ID: your_sandbox_terminal_id
Environment: https://test2.satim.dz
```

See [TEST_CARDS.md](TEST_CARDS.md) for test card numbers.

---

**For support, contact SATIM/GIE Monétique**
